
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SCREAM Scouting App</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            line-height: 1.6;
            color: #000000;
            max-width: 100%;
            margin: 0 auto;
            padding: 20px;
            box-sizing: border-box;
            background-color: #ffffff;
            font-size: 20px; /* Increased font size */
        }
        .infinite-list-container {
            margin-bottom: 20px;
            width: 100%;
        }
        .infinite-list-wrapper {
            display: flex;
            justify-content: center;
            align-items: flex-start;
        }
        .input-group {
            display: flex;
            flex-direction: column;
            margin-left: 20px;
            border-color: black;
            color: black;
            border: 10px;
        }
        .location-buttons {
            display: flex;
            gap: 5px;
            margin-bottom: 10px;
        }
        .location-button {
            padding: 5px;
            font-size: 14px;
            border-radius: 4px;
            background-color: #f0f0f0;
            border: 1px solid #ccc;
            cursor: pointer;
            color: black; /* Changed text color to black */
        }
        .location-button.selected {
            background-color: #4CAF50;
            color: white;
        }
        .list-container {
            max-height: 400px;
            overflow-y: auto;
            border: 1px solid #ddd;
            border-radius: 12px;
            padding: 10px;
            background-color: #f9f9f9;
            flex-grow: 1;
        }
        .infinitelistbutton {
            padding: 10px 10px;
            font-size: 20px; 
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        .listbutton:hover {
            background-color: #45a049;
        }
        .list-item {
            padding: 10px;
            margin: 5px 0;
            background-color: #f9f9f9;
            border-radius: 4px;
            display: flex;
            justify-content: space-between;
        }
        .delete-btn {
            background-color: #ff4444;
            padding: 2px 5px;
            border: none;
            border-radius: 4px;
            color: white;
            cursor: pointer;
            font-size: 16px;
        }
        .delete-btn:hover {
            background-color: #cc0000;
        }
        .endgame-select {
            padding: 15px;
            font-size: 24px;
            border-radius: 4px;
            width: 200px;
        }
        h1, h2 {
            color: #000000;
            text-align: center;
            font-size: 28px; /* Increased font size */
        }
        .form-group {
            margin-bottom: 15px;
        }
        .form-group > label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            font-size: 1.5em; /* Increased font size */
        }
        input[type="text"],
        input[type="number"],
        textarea {
            width: 100%;
            padding: 16px;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
            font-size: 20px; /* Increased font size */
            background-color: transparent;
            color: #000000;
        }
        input[type="radio"]:checked {
            background-color: rgb(0, 0, 0);
        }
        input[type="radio"] {
            background-color: transparent;
            border: 10px;
            outline: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            box-shadow: 0 0 0 2px #000;
            transition: background-color 0.1s ease;
        }
        #Robot_r1:checked,
        #Robot_r2:checked,
        #Robot_r3:checked {
            background-color: red;
        }
        #Robot_b1:checked,
        #Robot_b2:checked,
        #Robot_b3:checked {
            background-color: blue;
        }
        button {
            background-color: #d8ce44;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-size: 20px; /* Increased font size */
        }
        .color-buttons button {
            padding: 10px 20px;
            font-size: 20px; /* Increased font size */
            min-width: 80px;
            min-height: 60px;
            position: relative;
            z-index: 10;
        }
        #click-overlay {
            position: relative;
        }
        button:hover {
            background-color: #d8ce44d5;
        }
        .radio-group {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
        }
        .radio-option {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            min-width: 100%;
            background-color: transparent;
        }
        .radio-option label {
            font-weight: normal;
            font-size: 1.4em; /* Increased font size */
        }
        .radio-option input[type="radio"] {
            margin-top: 5px;
            min-height: 50px;
            min-width: 50px;
        }
        .radio-option:checked {
            border: 100px;
        }
        .logo {
            max-width: 200px;
            margin: 20px auto;
            display: block;
        }
        #qrcode {
            display: flex;
            justify-content: center;
            margin-top: 20px;
        }
        .underline {
            text-decoration: underline;
        }
        section {
            margin-bottom: 160px;
        }
        .submit-button {
            background-color: #d8ce44;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-size: 20px; /* Increased font size */
            display: block;
            margin: 20px auto;
        }
        .submit-button:hover {
            background-color: #d8ce44d5;
        }
        @media (max-width: 600px) {
            body {
                padding: 15px 20px;
                font-size: 20px; /* Increased font size */
            }
            .radio-group {
                flex-direction: column;
            }
            .radio-option {
                flex-direction: row;
                justify-content: space-between;
                width: 100%;
            }
            .radio-option input[type="radio"] {
                margin-top: 0;
            }
            .form-group button {
                padding: 10px 15px;
                font-size: 20px; /* Increased font size */
            }
            .form-group div[style*="display: flex"] button {
                padding: 10px 5px;
                font-size: 20px; /* Increased font size */
                width: 40px;
                height: 40px;
            }
            .form-group div[style*="display: flex"] span {
                font-size: 20px; /* Increased font size */
                min-width: 40px;
            }
            input[type="checkbox"] {
                min-width: 20px;
                min-height: 20px;
            }
        }
        .rating-container {
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        .rating {
            display: inline-flex;
            flex-direction: row-reverse;
            gap: 4px;
        }
        .rating input {
            display: none;
        }
        .rating label {
            font-size: 25px; /* Increased font size */
            color: #ddd;
            cursor: pointer;
            transition: color 0.2s;
            flex-grow: 1;
            text-align: center;
        }
        .rating label:before {
            content: "â˜…";
        }
        .rating input:checked ~ label {
            color: #ffd700;
        }
        .rating label:hover,
        .rating label:hover ~ label {
            color: #ffed4a;
        }
        .rating input:checked + label:hover,
        .rating input:checked ~ label:hover,
        .rating input:checked ~ label:hover ~ label,
        .rating label:hover ~ input:checked ~ label {
            color: #ffc107;
        }
        input[type="bool"] {
            border: black 10px;
        }
        input[type=".input-group"]
        .clear-rating {
            background: #f1f1f1;
            padding: 1px 2px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 20px; /* Increased font size */
            color: #666;
            transition: all 0.2s;
            margin-top: 10px;
        }
        .clear-rating:hover {
            background: #e4e4e4;
        }
        select[name="Team"] {
            width: 200px;
            font-size: 20px; /* Increased font size */
            padding: 10px;
            border-radius: 8px;
        }
    </style>
</head>

<body>
    <h1 id="page-title">SCREAM App</h1>
    <img src="logo2.png" alt="Team SCREAM Logo" class="logo">
    <form id="scouting-form"></form>
    <button class="submit-button" id="submit-button">Submit</button>
    <div id="qrcode"></div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lz-string/1.4.4/lz-string.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.4.0/dist/confetti.browser.min.js"></script>
    <script>
        let selectedLocation = null;

        function createInfiniteList(listId) {
            const container = document.createElement('div');
            container.className = 'infinite-list-container';

            const label = document.createElement('label');
            label.textContent = listId === 'auton' ? 'Auto Scores' : 'Teleop Scores';
            label.style.fontWeight = 'bold';
            label.style.fontSize = '1.1em';
            label.style.marginBottom = '5px';
            label.style.display = 'block';

            container.appendChild(label);

            const wrapper = document.createElement('div');
            wrapper.className = 'infinite-list-wrapper';

            const listDiv = document.createElement('div');
            listDiv.id = `list-${listId}`;
            listDiv.className = 'list-container';

            const inputGroup = document.createElement('div');
            inputGroup.className = 'input-group';

            const locationButtons = document.createElement('div');
            locationButtons.className = 'location-buttons';
            const locations = ['L1', 'L2', 'L3', 'L4', 'BAR', 'PRO'];

locations.forEach(location => {
    const button = document.createElement('button');
    button.className = 'location-button';
    button.textContent = location;
    button.type = 'button'; // Ensure it's not a submit button
    button.onclick = (event) => {
        event.preventDefault(); // Prevent default behavior
        selectLocation(location, button);
    };
    locationButtons.appendChild(button);
});

            const makeButton = document.createElement('button');
            makeButton.className = 'infinitelistbutton';
            makeButton.textContent = 'Make';
            makeButton.type = 'button';
            makeButton.onclick = () => addToList(listId, 'Make');

            const missButton = document.createElement('button');
            missButton.className = 'infinitelistbutton';
            missButton.textContent = 'Miss';
            missButton.type = 'button';
            missButton.onclick = () => addToList(listId, 'Miss');

            inputGroup.appendChild(locationButtons);
            inputGroup.appendChild(makeButton);
            inputGroup.appendChild(missButton);

            wrapper.appendChild(listDiv);
            wrapper.appendChild(inputGroup);

            container.appendChild(wrapper);

            return container;
        }

        function selectLocation(location, button) {
            selectedLocation = location;
            document.querySelectorAll('.location-button').forEach(btn => btn.classList.remove('selected'));
            button.classList.add('selected');
        }

        function createFormElement(item) {
            const div = document.createElement('div');
            div.className = 'form-group';
            const label = document.createElement('label');
            label.textContent = item.name;
            div.appendChild(label);

            if (item.code === 'Robot') {
                const img = document.createElement('img');
                img.src = 'field.png';
                img.alt = 'Field Image';
                img.style.maxWidth = '100%';
                img.style.marginBottom = '10px';
                div.appendChild(img);
            }

            let input;
            switch (item.type) {
                case 'scouter':
                    input = document.createElement('input');
                    input.type = 'text';
                    input.name = item.code;
                    input.required = item.required === 'true';
                    break;
                case 'match':
                    input = document.createElement('input');
                    input.type = 'number';
                    input.name = item.code;
                    input.min = item.min;
                    input.max = item.max;
                    input.required = item.required === 'true';
                    break;
                case 'event':
                case 'team':
                    input = document.createElement('select');
                    input.name = item.code;
                    input.required = item.required === 'true';
                    const teams = [
'16', '34', '59', '176', '180', '190', '201', '233', '353', '498',
'620', '706', '834', '971', '1002', '1218', '1501', '1538', '1540', '1561',
'1792', '1868', '1986', '2230', '2370', '2530', '2614', '2813', '2883', '2992',
'3035', '3128', '3459', '3506', '3536', '3572', '3863', '3990', '4039', '4135',
'4381', '4476', '4522', '4680', '4946', '5348', '5411', '5712', '5847', '6401',
'6429', '6436', '6574', '6989', '7539', '7558', '7709', '7769', '8214', '8503',
'8573', '8708', '8711', '9008', '9016', '9037', '9077', '9140', '9483', '9692',
'9785', '10011', '10589', '10690'

                    ];
                    teams.forEach(team => {
                        const option = document.createElement('option');
                        option.value = team;
                        option.textContent = team;
                        input.appendChild(option);
                    });
                    break;
                case 'level':
                case 'robot':
                case 'radio':
                    if (['e_end', 'e_CPU', 'e_APU', 'e_deadBot'].includes(item.code)) {
                        input = document.createElement('select');
                        input.name = item.code;
                        input.className = 'endgame-select';
                        input.required = item.required === 'true';
                        for (let key in item.choices) {
                            const option = document.createElement('option');
                            option.value = key;
                            option.textContent = item.choices[key];
                            if (key === item.defaultValue) option.selected = true;
                            input.appendChild(option);
                        }
                    } else {
                        input = document.createElement('div');
                        input.className = 'radio-group';
                        let firstRadio = true;
                        for (let key in item.choices) {
                            const radioDiv = document.createElement('div');
                            radioDiv.className = 'radio-option';
                            const radioLabel = document.createElement('label');
                            radioLabel.textContent = item.choices[key];
                            const radioInput = document.createElement('input');
                            radioInput.type = 'radio';
                            radioInput.name = item.code;
                            radioInput.value = key;
                            radioInput.id = `${item.code}_${key}`;
                            if (firstRadio && item.required === 'true') {
                                radioInput.required = true;
                                firstRadio = false;
                            }
                            if (key === item.defaultValue) radioInput.checked = true;
                            radioDiv.appendChild(radioLabel);
                            radioDiv.appendChild(radioInput);
                            input.appendChild(radioDiv);
                        }
                    }
                    break;
                case 'bool':
                    input = document.createElement('input');
                    input.type = 'checkbox';
                    input.name = item.code;
                    input.required = item.required === 'true';
                    break;
                case 'counter':
                    break;
                case 'text':
                    input = document.createElement('textarea');
                    input.name = item.code;
                    input.required = item.required === 'true';
                    if (item.size) input.cols = item.size;
                    if (item.maxSize) input.maxLength = item.maxSize;
                    break;
                case 'rating':
                    input = document.createElement('div');
                    input.className = 'rating-container';
                    input.innerHTML = `
                        <div class="rating">
                            <input type="radio" id="${item.code}_star5" name="${item.code}" value="5">
                            <label for="${item.code}_star5" title="5 stars"></label>
                            <input type="radio" id="${item.code}_star4" name="${item.code}" value="4">
                            <label for="${item.code}_star4" title="4 stars"></label>
                            <input type="radio" id="${item.code}_star3" name="${item.code}" value="3">
                            <label for="${item.code}_star3" title="3 stars"></label>
                            <input type="radio" id="${item.code}_star2" name="${item.code}" value="2">
                            <label for="${item.code}_star2" title="2 stars"></label>
                            <input type="radio" id="${item.code}_star1" name="${item.code}" value="1">
                            <label for="${item.code}_star1" title="1 star"></label>
                        </div>
                        <button class="clear-rating" onclick="clearRating('${item.code}')">Clear</button>
                    `;
                    break;
            }
            if (input) div.appendChild(input);
            return div;
        }

        function createSection(sectionName, items) {
            const section = document.createElement('section');
            const heading = document.createElement('h2');
            heading.textContent = sectionName;
            section.appendChild(heading);

            items.forEach(item => {
                const formElement = createFormElement(item);
                section.appendChild(formElement);
            });

            if (sectionName === 'Autonomous') {
                section.appendChild(createInfiniteList('auton'));
            } else if (sectionName === 'Teleoperated') {
                section.appendChild(createInfiniteList('teleop'));
            }

            return section;
        }

        const config_data = `{
            "dataFormat": "tsv",
            "title": "SCREAM App",
            "page_title": "Team SCREAM Scouting App",
            "checkboxAs": "10",
            "prematch": [
                { "name": "Scouters First Name", "code": "n", "type": "scouter", "required": "true" },
                { "name": "Match #", "code": "Match", "type": "match", "min": 1, "max": 150, "required": "true" },
                { "name": "Robot", "code": "Robot", "type": "robot", "choices": { "r1": "Red-1", "r2": "Red-2", "r3": "Red-3", "b1": "Blue-1", "b2": "Blue-2", "b3": "Blue-3" }, "required": "true", "defaultValue": "r1" },
                { "name": "Team #", "code": "Team", "type": "team", "required": "true" }
            ],
            "auton": [
                { "name": "Leave Starting Zone", "code": "leaveStarting", "type": "bool" }
            ],
            "teleop": [],
            "endgame": [
                { "name": "Ended", "code": "Ended", "type": "radio", "choices": { "Parked": "Parked", "Deep": "Climbed Deep", "Shallow": "Climbed Shallow", "None": "Neither" } },
                { "name": "Deadbot", "code": "deadBot", "type": "radio", "choices": { "None": "None", ".25": "Quarter", ".5": "Half", ".75": "Three Fourths", "full": "Full" } }
            ],
            "postmatch": [
                { "name": "Algae Picked Up", "code": "Algae", "type": "radio", "choices": { "Reef": "Reef", "Floor": "Floor", "Both": "Both", "Neither": "Neither" } },
                { "name": "Coral Picked Up", "code": "Coral", "type": "radio", "choices": { "Source": "Source", "Floor": "Floor", "Both": "Both", "Neither": "Neither" } },
                { "name": "Driver Skill", "code": "driver", "type": "rating" },
                { "name": "Defense Rating", "code": "defense", "type": "rating" },
                { "name": "Speed Rating", "code": "speed", "type": "rating" }
            ]
        }`;

        const config = JSON.parse(config_data);
        const form = document.getElementById('scouting-form');

        document.getElementById('page-title').textContent = config.page_title;

        form.appendChild(createSection('Pre-match', config.prematch));
        form.appendChild(createSection('Autonomous', config.auton));
        form.appendChild(createSection('Teleoperated', config.teleop));
        form.appendChild(createSection('End Game', config.endgame));
        form.appendChild(createSection('Post-match', config.postmatch));

        function addToList(listId, result) {
            if (!selectedLocation) {
                alert('Please select a location first.');
                return;
            }

            const listDiv = document.getElementById(`list-${listId}`);
            const item = document.createElement('div');
            item.className = 'list-item';
            
            const text = document.createElement('span');
            text.textContent = `${result} score on ${selectedLocation}`;
            
            const deleteBtn = document.createElement('button');
            deleteBtn.textContent = 'Delete';
            deleteBtn.className = 'delete-btn';
            deleteBtn.onclick = function() {
                listDiv.removeChild(item);
            };
            
            item.appendChild(text);
            item.appendChild(deleteBtn);
            listDiv.appendChild(item);

            listDiv.scrollTop = listDiv.scrollHeight;
        }

        function collectListData(listId) {
            const listDiv = document.getElementById(`list-${listId}`);
            const items = listDiv.getElementsByClassName('list-item');
            const dataMap = {
                'MA L1': 0, 'MA L2': 0, 'MA L3': 0, 'MA L4': 0, 'MA BAR': 0, 'MA PRO': 0,
                'MI L1': 0, 'MI L2': 0, 'MI L3': 0, 'MI L4': 0, 'MI BAR': 0, 'MI PRO': 0
            };

            Array.from(items).forEach(item => {
                const text = item.querySelector('span').textContent;
                const [result, location] = text.split(' score on ');
                const key = `${result.substring(0, 2).toUpperCase()} ${location}`;
                dataMap[key] = (dataMap[key] || 0) + 1;
            });

            return Object.entries(dataMap).map(([key, count]) => `${key} ${count};`).join(' ');
        }

        document.addEventListener('DOMContentLoaded', function() {
            const submitButton = document.getElementById('submit-button');
            
            submitButton.addEventListener('click', function(event) {
                event.preventDefault();

                if (!validateForm()) {
                    alert('Please fill out all required fields.');
                    return;
                }

                const formData = new FormData(form);
                let dataString = '';
                let leaveStartingIncluded = false;

                for (let [key, value] of formData.entries()) {
                    if (key === 'n' || key === 'Match' || key === 'Robot' || key === 'Team') {
                        dataString += `${value};`;

                        if (key === 'Team' && !leaveStartingIncluded) {
                            const leaveStartingValue = formData.get('leaveStarting') === 'on' ? 'true' : 'false';
                            dataString += `${leaveStartingValue};`;
                            leaveStartingIncluded = true;

                            const autonData = collectListData('auton');
                            dataString += `${autonData}`;

                            const teleopData = collectListData('teleop');
                            dataString += `${teleopData}`;
                        }
                        continue;
                    }

                    if (key === 'leaveStarting') {
                        continue;
                    }

                    dataString += `${value};`;
                }

                if (!leaveStartingIncluded) {
                    dataString += `stay;`;

                    const autonData = collectListData('auton');
                    dataString += `${autonData}`;

                    const teleopData = collectListData('teleop');
                    dataString += `${teleopData}`;
                }

                generateQRCode(dataString);

                // Trigger confetti effect
                confetti({
                    particleCount: 100,
                    spread: 70,
                    origin: { y: 0.6 }
                });

                console.log('Resetting form...');
                resetForm();
            });

            function validateForm() {
                let isValid = true;
                const requiredFields = form.querySelectorAll('input[required], select[required], textarea[required]');

                requiredFields.forEach(field => {
                    if (field.name !== 'leaveStarting' && !field.value.trim()) {
                        isValid = false;
                        field.style.borderColor = 'red';
                    } else {
                        field.style.borderColor = '';
                    }
                });

                return isValid;
            }

            function generateQRCode(data) {
                const qrContainer = document.getElementById('qrcode');
                qrContainer.innerHTML = '';

                new QRCode(qrContainer, {
                    text: data,
                    width: 256,
                    height: 256,
                    correctLevel: QRCode.CorrectLevel.L
                });
            }
            function resetForm() {
    console.log('Resetting form...');

    const scouterNameInput = form.querySelector('input[name="n"]');
    const matchNumberField = form.querySelector('input[name="Match"]');
    const robotSelectionInputs = form.querySelectorAll('input[name="Robot"]');

    console.log('Scouter Name Input:', scouterNameInput);
    console.log('Match Number Field:', matchNumberField);
    console.log('Robot Selection Inputs:', robotSelectionInputs);

    if (!scouterNameInput || !matchNumberField || robotSelectionInputs.length === 0) {
        console.error('One or more form elements are missing.');
        return;
    }

    const scouterName = scouterNameInput.value;
    const selectedRobot = Array.from(robotSelectionInputs).find(input => input.checked)?.value;

    // Increment match number before resetting the form
    matchNumberField.value = parseInt(matchNumberField.value) + 1; // Increment match number

    form.reset();

    // Restore scouter name and robot selection after reset
    scouterNameInput.value = scouterName;
    if (selectedRobot) {
        const robotInputToSelect = Array.from(robotSelectionInputs).find(input => input.value === selectedRobot);
        if (robotInputToSelect) {
            robotInputToSelect.checked = true;
        }
    }

    // Clear dynamic lists
    document.getElementById('list-auton').innerHTML = '';
    document.getElementById('list-teleop').innerHTML = '';

    // Reset counters if any
    const counters = form.querySelectorAll('input[type="hidden"]');
    counters.forEach(counter => {
        counter.value = '0';
        counter.previousElementSibling.textContent = '0';
    });

    // Clear any selected location
    selectedLocation = null;
    document.querySelectorAll('.location-button').forEach(btn => btn.classList.remove('selected'));

    console.log('Form reset complete.');
}



});

        function clearRating(ratingName) {
            const ratings = document.getElementsByName(ratingName);
            ratings.forEach(radio => {
                radio.checked = false;
            });
        }

        document.querySelectorAll('.clear-rating').forEach(button => {
            button.addEventListener('click', function(event) {
                event.preventDefault();
                clearRating(button.previousElementSibling.name);
            });
        });

    </script>
    <a href="index.html" class="submit-button" style="text-decoration: none; display: block; text-align: center;">Back</a>
</body>
</html>
